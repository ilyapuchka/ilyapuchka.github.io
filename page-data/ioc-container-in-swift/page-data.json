{"componentChunkName":"component---src-templates-blog-post-js","path":"/ioc-container-in-swift/","result":{"data":{"site":{"siteMetadata":{"title":"Ilya Puchka","siteUrl":"https://ilya.puchka.me"}},"markdownRemark":{"id":"0c3802aa-a58a-59fa-aea8-be9c2456921c","excerpt":"Note (15.04.16): This post is updated to reflect some of the latest changes in Dip. In my previous post I talked about dependency injection framework forâ€¦","html":"<blockquote>\n<p>Note (15.04.16): This post is updated to reflect some of the latest changes in Dip.</p>\n</blockquote>\n<p>In my <a href=\"http://ilya.puchka.me/view-controller-thinning-dependency-injection/\">previous post</a> I talked about dependency injection framework for Objective-C called <a href=\"http://typhoonframework.org\">Typhoon</a>. It's very easy to start to use it, yet it's very powerful (maybe even too much cause there are so much stuff you can do with it). When I first time saw it it was not love at first sight. I though: \"Pfff, I don't need all these crazy swizzling and other runtime magic, I can inject everything manually\". But actually I didn't and there were lot's of lazy properties and singletons all over my code. Actually I didn't thought about design too much. At the point when we met again I was a bit more experienced and thanks to some of my colleagues started to value clean code and design much more. That helped me to understand the value of this framework and IoC in general. Some people think that it only makes code even more complicated. Yes, if you look at its sample project, fully backed by Typhoon, where they inject everything even app delegate, I will agree that it is probably too much. But believe me, it's still much batter than what you can have without it - giant \"directories\" of objects holding references literally to every other component of the system and passed to all of them so that they can talk to each other breaking communications patterns of you system in all possible ways, or objects with initializers with ten or more arguments, or tests that mock everything just to create sut (system under test) object or all of this together (based on my personal experience). Introducing IoC is definitely not the first thing you should think of trying to improve your design but such things as Typhoon make your code (at least when you deal with dependencies) much more structured, you simply know where all the things are defined and you no more need to think where something comes from, how it is created or how I replace it with fake implementation in test. You just look at your definitions and see it. And it's really very easy to reed, you don't even need to know how it works to understand what it does. I shared it with my colleagues, showed them how it works and encouraged to use it. And now after about six months when I'm already not in that team any more they not just build all of their applications with it, but also are part of Typhoon core contributors and share their experience with others.</p>\n<p>But I'm here not to advocate Typhoon. It's the end of 2015 and there is Swift. Such things as Typhoon rely a lot on Objective-C runtime thus making it hard to use with pure Swift (meaning without <code>@objc</code> and <code>dynamic</code>). And it's just too wordy for Swift. You can use it, but I don't encourage you. You can try to use Objective-C for it what will be probably a better idea but then you will need to deal with languages interoperability.</p>\n<p>So is there a way to do the same (well there are just too much stuff there in Typhoon so I mean only core IoC container functionality) in Swift way or are we doomed to stick to Objective-C?</p>\n<p>Good news - there is such way. And actually it's pretty easy and elegant. Take a look at <a href=\"https://github.com/AliSoftware/Dip\">Dip</a> project. It's rather basic for now but there is a huge space for improvements. I'm very excited about it and started to contribute to it recently so there are few cool features coming up, like circular dependencies and automatic property injection - they are already available in my <a href=\"https://github.com/ilyapuchka/Dip/tree/develop\">fork</a>.</p>\n<p>Here is how it looks like. I will use very basic examples not to disturb you with unneeded details.</p>\n<p>Let's say you have some protocol with different implementations:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token class-name\">Service</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ServiceImp</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Service</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FakeService</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Service</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>In production code you can use real implementation:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">container<span class=\"token punctuation\">.</span>register <span class=\"token punctuation\">{</span> <span class=\"token class-name\">ServiceImp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Service</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">let</span> service <span class=\"token operator\">=</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Service</span> <span class=\"token comment\">// -> ServiceImp</span></code></pre></div>\n<p>And in your tests you use another implementation:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">container<span class=\"token punctuation\">.</span>register <span class=\"token punctuation\">{</span> <span class=\"token class-name\">FakeService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Service</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">let</span> service <span class=\"token operator\">=</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Service</span> <span class=\"token comment\">// -> FakeService</span></code></pre></div>\n<p>So the only difference is what implementations you register in runtime. You source code does not change because it does not care about concrete implementations, it only needs reference to container.</p>\n<p>Do you fill it?</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">container<span class=\"token punctuation\">.</span>register <span class=\"token punctuation\">{</span> <span class=\"token class-name\">ServiceImp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Service</span> <span class=\"token punctuation\">}</span>\ncontainer<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Service</span></code></pre></div>\n<p>Remove dots, curly and round brackets:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">container register <span class=\"token class-name\">ServiceImp</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Service</span> \ncontainer resolve <span class=\"token keyword\">as</span> <span class=\"token class-name\">Service</span></code></pre></div>\n<p>It's simple and beautiful. As you might guess already the first line registers factory (closure or method) to create instances of <code>Service</code> protocol and the second line creates this instance.</p>\n<p>Everything else can be built on top of that. Need runtime arguments? Easy:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">container<span class=\"token punctuation\">.</span>register <span class=\"token punctuation\">{</span> url<span class=\"token punctuation\">,</span> port <span class=\"token keyword\">in</span> <span class=\"token class-name\">ServiceImp</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">:</span> port<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Service</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">let</span> service <span class=\"token operator\">=</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token number\">80</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Service</span></code></pre></div>\n<p>Circular dependencies? Well, not so easy but possible:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token class-name\">Server</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">class</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> client<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Client</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span> <span class=\"token keyword\">set</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ServerImp</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">weak</span> <span class=\"token keyword\">var</span> client<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Client</span><span class=\"token operator\">?</span>\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">protocol</span> <span class=\"token class-name\">Client</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">class</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> server<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ClientImp</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> server<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Server</span>\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Server</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>server <span class=\"token operator\">=</span> server\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\ncontainer<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">ObjectGraph</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">ClientImp</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">:</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">}</span>\n\ncontainer<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">ObjectGraph</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token class-name\">ServerImp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Server</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span>resolveDependencies <span class=\"token punctuation\">{</span> container<span class=\"token punctuation\">,</span> server <span class=\"token keyword\">in</span>\n        server<span class=\"token punctuation\">.</span>client <span class=\"token operator\">=</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Client</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> client <span class=\"token operator\">=</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Client</span> <span class=\"token comment\">// -> ClientImp</span>\n<span class=\"token keyword\">let</span> server <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>server <span class=\"token comment\">// -> ServerImp</span></code></pre></div>\n<p>That was a bit complex but can be improved with auto-injection:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token class-name\">Service</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> client<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">protocol</span> <span class=\"token class-name\">Client</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">class</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Service</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ServiceImp</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Service</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> _client <span class=\"token operator\">=</span> <span class=\"token class-name\">InjectedWeak</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">Client</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">var</span> client<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> _client<span class=\"token punctuation\">.</span>value<span class=\"token operator\">!</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ClientImp</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> _service <span class=\"token operator\">=</span> <span class=\"token class-name\">Injected</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">Service</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">var</span> service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Service</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> _service<span class=\"token punctuation\">.</span>value<span class=\"token operator\">!</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\ncontainer<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">ObjectGraph</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token class-name\">ServiceImp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Service</span> <span class=\"token punctuation\">}</span>\ncontainer<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">ObjectGraph</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token class-name\">ClientImp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Client</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> client <span class=\"token operator\">=</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Client</span> <span class=\"token comment\">// -> ClientImp</span>\n<span class=\"token keyword\">let</span> service <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>service <span class=\"token comment\">// -> ServerImp</span></code></pre></div>\n<p>Small wrappers and computed properties for convenience and we are back to simple syntax.</p>\n<h3>How it works</h3>\n<p>So what's the magic? The fundamental blocks of Dip are generics. They play very nice here and let to use very clean and Swifty syntax. Let's look at <code>register</code> method first. I will use simpler and slightly modified <a href=\"https://github.com/AliSoftware/Dip/blob/master/Dip/Dip/Dip.swift#L88-L93\">original implementation</a> to demonstrate basic idea.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function-definition function\">register</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>tag tag<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Tag</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">,</span> factory<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token class-name\">T</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">DefinitionOf</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> key <span class=\"token operator\">=</span> <span class=\"token class-name\">Key</span><span class=\"token punctuation\">(</span>protocolType<span class=\"token punctuation\">:</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> associatedTag<span class=\"token punctuation\">:</span> tag<span class=\"token punctuation\">)</span>\n    dependencies<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> factory\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> dependencies <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">Key</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token keyword\">Any</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">Key</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">Hashable</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Equatable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> protocolType<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Any</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">Type</span>\n    <span class=\"token keyword\">var</span> associatedTag<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Tag</span><span class=\"token operator\">?</span>\n    \n    <span class=\"token keyword\">var</span> hashValue<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Int</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string-literal\"><span class=\"token string\">\"</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">protocolType</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">-</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">associatedTag</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">.</span>hashValue\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token operator\">==</span><span class=\"token punctuation\">(</span>lhs<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Key</span><span class=\"token punctuation\">,</span> rhs<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> lhs<span class=\"token punctuation\">.</span>protocolType <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>protocolType <span class=\"token operator\">&amp;&amp;</span> lhs<span class=\"token punctuation\">.</span>associatedTag <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>associatedTag\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here we simply store passed in factory by key that is created with generic type and tag (tags don't matter here but I will use them later in auto-injection). To resolve we create the same key, get the factory and call it:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function-definition function\">resolve</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Tag</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">T</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> key <span class=\"token operator\">=</span> <span class=\"token class-name\">Key</span><span class=\"token punctuation\">(</span>protocolType<span class=\"token punctuation\">:</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> associatedTag<span class=\"token punctuation\">:</span> tag<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> factory <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>dependencies<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">fatalError</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"No instance factory registered with </span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">key</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span> \n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">factory</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token class-name\">T</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The magic is how generics and <code>as</code> operator work here together. If you don't use <code>as</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">container<span class=\"token punctuation\">.</span>register <span class=\"token punctuation\">{</span> <span class=\"token class-name\">ServiceImp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>then <code>T.self == ServiceImp</code>. But if you use it:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">container<span class=\"token punctuation\">.</span>register <span class=\"token punctuation\">{</span> <span class=\"token class-name\">ServiceImp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">Service</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>then <code>T.self == Service</code>! With <code>as</code> you upcast concrete class <code>ServiceImp</code> to protocol <code>Service</code> and method now does not know that you pass it <code>ServiceImp</code>, it only knows that it is <code>Service</code>, so type <code>T</code> will be <code>Service</code>. Now if we use the same trick with <code>as</code> in resolve it will create the same key and find exactly the same factory that we registered for that type. When we store factories we store them as methods that return <code>Any</code> type, but generic type in <code>register</code> and <code>resolve</code> together with key based on it make sure that instance that is returned by factory has the same type (or is its derivative) as type <code>T</code> so downcast from <code>Any</code> to <code>T</code> is absolutely safe. And that's all the \"magic\". Now it can be improved to allow other features.</p>\n<h3>Runtime arguments</h3>\n<p>For example what if we need to provide some runtime arguments to our factories when we resolve types? A bit more of generics and it's possible. First we need to distinguish factories that accept different runtime arguments. For that we add type of factory to the lookup key:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">DefinitionKey</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">Hashable</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Equatable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> protocolType<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Any</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">Type</span>\n    <span class=\"token keyword\">var</span> factoryType<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Any</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">Type</span>\n    <span class=\"token keyword\">var</span> associatedTag<span class=\"token punctuation\">:</span> <span class=\"token class-name\">DependencyContainer</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Tag</span><span class=\"token operator\">?</span>\n    \n    <span class=\"token keyword\">var</span> hashValue<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Int</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string-literal\"><span class=\"token string\">\"</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">protocolType</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">-</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">factoryType</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">-</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">associatedTag</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">.</span>hashValue\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token operator\">==</span><span class=\"token punctuation\">(</span>lhs<span class=\"token punctuation\">:</span> <span class=\"token class-name\">DefinitionKey</span><span class=\"token punctuation\">,</span> rhs<span class=\"token punctuation\">:</span> <span class=\"token class-name\">DefinitionKey</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> lhs<span class=\"token punctuation\">.</span>protocolType <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>protocolType <span class=\"token operator\">&amp;&amp;</span> lhs<span class=\"token punctuation\">.</span>factoryType <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>factoryType <span class=\"token operator\">&amp;&amp;</span> lhs<span class=\"token punctuation\">.</span>associatedTag <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>associatedTag\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To have more flexibility container will store not just factories, but <em>definitions</em>, generic class that for now will only hold reference to factory which now will be of type <code>Any</code> - we don't care <em>here</em> what it is (and we just don't know), we only need to store it.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token class-name\">Definition</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DefinitionOf</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Definition</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> factory<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Any</span>\n    <span class=\"token keyword\">let</span> scope<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ComponentScope</span>\n\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Any</span><span class=\"token punctuation\">,</span> scope<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ComponentScope</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>factory <span class=\"token operator\">=</span> factory\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>scope <span class=\"token operator\">=</span> scope\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In <code>register</code> method to get access to type of passed in factory we will use generic again:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function-definition function\">register</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>tag tag<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Tag</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">,</span> scope<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ComponentScope</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">Prototype</span><span class=\"token punctuation\">,</span> factory<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">DefinitionOf</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">register</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">:</span> tag<span class=\"token punctuation\">,</span> factory<span class=\"token punctuation\">:</span> factory<span class=\"token punctuation\">,</span> scope<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">Prototype</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function-definition function\">registerFactory</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">F</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>tag tag<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Tag</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">,</span> scope<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ComponentScope</span><span class=\"token punctuation\">,</span> factory<span class=\"token punctuation\">:</span> <span class=\"token class-name\">F</span><span class=\"token punctuation\">,</span> scope<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ComponentScope</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">DefinitionOf</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> key <span class=\"token operator\">=</span> <span class=\"token class-name\">DefinitionKey</span><span class=\"token punctuation\">(</span>protocolType<span class=\"token punctuation\">:</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> factoryType<span class=\"token punctuation\">:</span> <span class=\"token class-name\">F</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> associatedTag<span class=\"token punctuation\">:</span> tag<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">let</span> definition <span class=\"token operator\">=</span> <span class=\"token class-name\">DefinitionOf</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">F</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">:</span> factory<span class=\"token punctuation\">,</span> scope<span class=\"token punctuation\">:</span> scope<span class=\"token punctuation\">)</span>\n    dependencies<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> definition\n    <span class=\"token keyword\">return</span> definition\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We added another <code>register</code> method that does not care about actual type of factory, it can be anything (in practice it will be different kinds of closures), it only needs to use this type to create a key. Now we can use this second <code>register</code> method in method that registers factory with one runtime argument:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function-definition function\">register</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Arg1</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>tag tag<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Tag</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">,</span> scope<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ComponentScope</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">Prototype</span><span class=\"token punctuation\">,</span> factory<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Arg1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">DefinitionOf</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">register</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">:</span> tag<span class=\"token punctuation\">,</span> factory<span class=\"token punctuation\">:</span> factory<span class=\"token punctuation\">,</span> scope<span class=\"token punctuation\">:</span> scope<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here we use generic again, this time for type of runtime argument. In this method type <code>F</code> will be <code>Arg1 -> T</code>. Let's remember that.</p>\n<p>That was one part of the problem, we can now register factory with one runtime argument or with no arguments, but how we resolve it? And if we have two different factories whit argument and with no argument registered for the same type how we choose between them? Here generics help us again.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function-definition function\">resolve</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>tag tag<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Tag</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">T</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">_resolve</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">:</span> tag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> <span class=\"token function\">factory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function-definition function\">_resolve</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">F</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>tag tag<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Tag</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">,</span> builder<span class=\"token punctuation\">:</span> <span class=\"token class-name\">F</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">T</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> key <span class=\"token operator\">=</span> <span class=\"token class-name\">DefinitionKey</span><span class=\"token punctuation\">(</span>protocolType<span class=\"token punctuation\">:</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> factoryType<span class=\"token punctuation\">:</span> <span class=\"token class-name\">F</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> associatedTag<span class=\"token punctuation\">:</span> tag<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> definition <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>dependencies<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token class-name\">DefinitionOf</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token operator\">></span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">fatalError</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">builder</span><span class=\"token punctuation\">(</span>definition<span class=\"token punctuation\">.</span>factory <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token class-name\">F</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The same way we introduced <code>register</code> method with generic type <code>F</code> for factory we add <code>resolve</code> method with type <code>F</code> that stands for the same type. But instead of passing actual factory to this method we pass it a <em>builder</em> closure that accepts factory and returns instance that it creates, which is of type <code>T</code>. To build a key we use factory type <code>F</code>, get stored definition and pass factory that it holds to builder closure. Generic type <code>F</code> and key based on it make sure that type of factory stored in definition is actually <code>F</code>, so downcast is safe. The keys is also based on type of <code>T</code>, so we a sure that <code>F</code> is a closure that returns <code>T</code>. But where we get builder from? We make it ourselves in the outer <code>resolve</code> method - in this case it's a closure that accepts factory and returns it's value. The same way we can add <code>resolve</code> method that accepts runtime argument and pass it to factory:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function-definition function\">resolve</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Arg1</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>tag tag<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Tag</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">,</span> withArguments<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Arg1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">T</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">:</span> tag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Arg1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> <span class=\"token function\">factory</span><span class=\"token punctuation\">(</span>arg1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here we know that factory that we want to use should accept one argument, so we set it's type to <code>Arg1 -> T</code>. Builder type will be <code>Arg1 -> T -> T</code> and <code>F</code> will be <code>Arg1 -> T</code>. That's exactly the same type that we used in <code>register</code>, of course if <code>Arg1</code> used here and <code>Arg1</code> used there are the same. So the key built with this type <code>F</code> will give us factory that accepts argument of type <code>Arg1</code>.</p>\n<p>Now we can add methods for as many arguments as we want. Use of generic type <code>F</code> for factory type lets us capture factory signature that contains all of its arguments and return type. So for the same type we can register different factories that accepts different types of parameters. Which factory will be used depends on what parameters we pass to <code>resolve</code> and - what is also important - in what order.</p>\n<h3>Conclusion</h3>\n<p>I wanted to describe how I implemented circular dependencies and auto-injection but this post becomes too long already so I will leave it for the next time. Even without these features Dip is rather useful, can cover a lot of cases and can help in tests and loose coupling. Yet it's very simple. Probably what I like most about it is that how <code>as</code> operator works. It will be very easy to build new functionality on top of what we have now, providing features for UI components and Storyboards like Typhoon does but preserving it's swiftness and simplicity. When that will be done I hope there will be no more need for Typhoon in Swift code.</p>","fields":{"slug":"/ioc-container-in-swift/"},"frontmatter":{"id":"5b6f5a3a9d28c70f0f015f6b","title":"IoC container in Swift","date":"November 08, 2015","description":"In my previous post I talked about dependency injection framework for Objective-C called Typhoon. It's very easy to start to use it, yet it's very powerful (maybe even too much cause there are so much stuff you can do with it). But I'm here not to advocate Typhoon. It's the end of 2015 and there is Swift. Is there a way to do the same (well there are just too much stuff there in Typhoon so I mean only core IoC container functionality) in Swift way or are we doomed to stick to Objective-C?","tags":""}},"previous":{"excerpt":"In my previous post I described how you can break business and presentation logic in small PONSO's to achieve better separation of concerns and think viewâ€¦","fields":{"slug":"/view-controller-thinning-dependency-injection/"},"frontmatter":{"title":"View controller thinning. Dependency injection with Typhoon.","date":"October 27, 2015"}},"next":{"excerpt":"Note (15.04.16): This post is updated to reflect some of the latest changes in Dip. In my previous post I wrote about Dip, lightweight IoC written in Swiftâ€¦","fields":{"slug":"/ioc-container-in-swift-circular-dependencies-and-auto-injection/"},"frontmatter":{"title":"IoC container in Swift. Circular dependencies and auto-injection","date":"November 11, 2015"}}},"pageContext":{"id":"0c3802aa-a58a-59fa-aea8-be9c2456921c","previousPostId":"3000126a-7b9c-5297-a86f-115d5d881ed7","nextPostId":"1b455eeb-dc57-5280-a846-92862e996e23"}},"staticQueryHashes":["2355076697","2841359383"],"slicesMap":{}}