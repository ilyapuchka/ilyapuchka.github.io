{"componentChunkName":"component---src-templates-blog-post-js","path":"/view-controller-thinning/","result":{"data":{"site":{"siteMetadata":{"title":"Ilya Puchka","siteUrl":"https://ilya.puchka.me"}},"markdownRemark":{"id":"35dff8c7-ea1c-5e75-aeb4-a8fca13e44f5","excerpt":"\"Massive view controller\" is one of the most favorite topic for iOS developers when they talk about architecture. A lot have been said on this topic alreadyâ€¦","html":"<p>\"Massive view controller\" is one of the most favorite topic for iOS developers when they talk about architecture. A lot have been said on this topic already, even more will be said in future cause unfortunately there is no silver bullet and view controller still stay massive in many projects. Recently Andy Matuschak presented <a href=\"https://realm.io/news/andy-matuschak-refactor-mega-controller/\">here</a> and <a href=\"https://vimeo.com/140037432\">there</a> a live coding session on this topic. So you can see it's a well know and still actual problem.</p>\n<p>The real problem is that there are a lot of responsibility in UIViewController already defined in UIKit. So why to add even more? We should try to minimize view controller responsibility as much as any other class in our application. Apple have made view controller the hart of each iOS application so we should respect them and treat them with the same care as our model, network or persistence layer. But instead we centralize all our code in view controllers.</p>\n<p>Recently I've started to work on my new home project and from the beginning I've tried few techniques that I wanted to try for a long time. I think they can be useful in any other project. Not as a step-by-step recipe to solve all possible problems, but as concepts that you can apply to solve your particular case.</p>\n<p>A lot of code is involved in this topic so I decided to break it in few parts. In this post I will show how you can refactor messy view controller and make it thinner so that it will follow Single Responsibility principle more. In next post I will show how you can make a next step forward to SRP with concept of behaviors and how Interface Builder lets us decrease lines of code even more if we use it not just to create layouts but as a dependency injection tool. After that I will take the same problem of dependency injection and will show how to solve it with Typhoon framework. You can follow the history of changes <a href=\"https://github.com/ilyapuchka/ViewControllerThinning/commits/master\">here on GitHub</a>.</p>\n<p>We will build very simple single view application which will display authorization form and let user to login on arbitrary service. To make things more interesting it will involve some animations and custom UI. We won't need to make any real network requests but for demonstration I'll use <a href=\"https://github.com/ilyapuchka/SwiftNetworking\">SwiftNetworking</a> - framework that I described in <a href=\"http://ilya.puchka.me/networking-in-swift/\">one of my previous posts</a>.</p>\n<h4>Specification</h4>\n<p>Application should display two input fields - for email and password - and two buttons - to login and to restoring password. If login fails the alert with error message should be displayed. If login or password are invalid then corresponding input fields should be marked with red dot at their right side and should be animated with \"shake\" animation. When user selects input field its background color should change to slightly lighter color with animation. When user deselects input filed its background color should animate back to initial color. Same effect should be applied to login button when user touches it or removes his finger from it. It should look something like this:</p>\n<p><img src=\"/images/PyTEKxWkVk.gif\" alt=\"gif\"></p>\n<h4>Initial state</h4>\n<p>As initial state we will take massive view controller that manages everything - views, control actions, animations and business logic.<br>\nThe whole code is too long to paste it here, so here are links on GitHub - <a href=\"https://github.com/ilyapuchka/ViewControllerThinning/commit/c59a559a8e9696e7a1b7db985541d15c4bd4755f#diff-c4235c55b20764be6f0579b4eff3f989\">ViewController.swift</a>, <a href=\"https://github.com/ilyapuchka/ViewControllerThinning/commit/c59a559a8e9696e7a1b7db985541d15c4bd4755f#diff-6bc6e79c934260fdd27548d3de88e9f5\">FormTextField.swift</a>.</p>\n<p>You can see that view controller does so much stuff that it is very hard to understand what it actually does. The only thing that it does not manages are some text input metrics. And this is only because of the API that <code>UITextField</code> provides.</p>\n<h4>Helpers</h4>\n<p>We will start with extracting some parts of code in small helpers. To setup icons of text fields we use hardcoded file names. With Swift 2 we can instead define simple extension of UIImage that will use enum with String raw value instead of String file name to create image.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">UIImage</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">enum</span> <span class=\"token class-name\">AssetIdentifier</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token class-name\">InputEmailIcon</span>\n        <span class=\"token keyword\">case</span> <span class=\"token class-name\">InputPasswordIcon</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">convenience</span> <span class=\"token keyword\">init</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span><span class=\"token omit keyword\">_</span> assetIdentifier<span class=\"token punctuation\">:</span> <span class=\"token class-name\">AssetIdentifier</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>named<span class=\"token punctuation\">:</span> assetIdentifier<span class=\"token punctuation\">.</span>rawValue<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Swift 2 will automatically assign raw values to enum cases with String raw value type if they are not provided explicitly. So only thing that you should care about is that enum cases should match assets identifiers. If you want you can even generate such enum on build time using some script. This way you will never mistype image names in your code and you will have code completion.</p>\n<p>Next we can make corner radius <code>IBInspectable</code> property so that we don't need to set it in code and don't need to access it through layer property.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">UIView</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token attribute atrule\">@IBInspectable</span>\n    <span class=\"token keyword\">var</span> cornerRadius<span class=\"token punctuation\">:</span> <span class=\"token class-name\">CGFloat</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">get</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> layer<span class=\"token punctuation\">.</span>cornerRadius\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span>\n            clipsToBounds <span class=\"token operator\">=</span> newValue <span class=\"token operator\">!=</span> <span class=\"token number\">0</span>\n            layer<span class=\"token punctuation\">.</span>cornerRadius <span class=\"token operator\">=</span> newValue\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now any subclass of UIView will have field to set it's corner radius in Interface Builder.</p>\n<p>Currently we setup text field's icon tint color manually in code and separately for each text field's. It would be cool if we can set it using UIAppearance. The problem is that for that we need to set tint color for UIImageView only if it is contained in UITextField using <code>+(instancetype)appearanceWhenContainedIn:(Class &#x3C;UIAppearanceContainer>)ContainerClass, ...</code>. This API is available from Objective-C but is not available from Swift in iOS 8 (it's available for Swift only in iOS 9 with <code>+ (instancetype)appearanceWhenContainedInInstancesOfClasses:(NSArray&#x3C;Class &#x3C;UIAppearanceContainer>> *)containerTypes</code>). To solve that we can define Objective-C category that will accept only one class instead of variadic parameter.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">@import UIKit;\n\n@interface UIView (Appearance)\n\n+ (instancetype)gh_appearanceWhenContainedIn:(Class&lt;UIAppearanceContainer>)containerClass;\n\n@end\n\n@implementation UIView (Appearance)\n\n+ (instancetype)gh_appearanceWhenContainedIn:(Class&lt;UIAppearanceContainer>)containerClass {\n    return [self appearanceWhenContainedIn:containerClass, nil];\n}\n\n@end</code></pre></div>\n<p>You can notice that in our application we have few animations with the same duration. It would be cool if we can add implicit animation duration for each view. That will make animations consistent through the whole application. Also you will see how easy it is to add custom UIAppearance properties.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">@import UIKit;\n\n@interface UIView (Appearance)\n...\n@property (nonatomic) NSTimeInterval implicitAnimationDuration UI_APPEARANCE_SELECTOR;\n\n@end\n\n@import ObjectiveC.runtime;\n\n@implementation UIView (Appearance)\n...\n- (void)setImplicitAnimationDuration:(NSTimeInterval)implicitAnimationDuration\n{\n    objc_setAssociatedObject(self, @selector(implicitAnimationDuration), @(implicitAnimationDuration), OBJC_ASSOCIATION_RETAIN_NONATOMIC);\n}\n\n- (NSTimeInterval)implicitAnimationDuration\n{\n    return [objc_getAssociatedObject(self, @selector(implicitAnimationDuration)) ?: @(0.25) doubleValue];\n}\n\n@end</code></pre></div>\n<p>Here we use Objective-C runtime to define animation duration value using UIView category. To make it accessible through UIAppearance proxy object of UIView we only need to annotate it with <code>UI_APPEARANCE_SELECTOR</code> <sup>1</sup>.</p>\n<p>With Swift animations can be simplified even more. Default <code>animationWithDiration</code> method is provided with different set of parameters but if you let's say want to specify animation options you will need to provide all other parameters like delay and completion handler. With Swift we can make it better by adding default values for arguments.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">UIView</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">class</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">animateWithDuration</span><span class=\"token punctuation\">(</span>duration<span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSTimeInterval</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> delay<span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSTimeInterval</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIViewAnimationOptions</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> animations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">animateWithDuration</span><span class=\"token punctuation\">(</span>duration<span class=\"token punctuation\">,</span> delay<span class=\"token punctuation\">:</span> delay<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> options<span class=\"token punctuation\">,</span> animations<span class=\"token punctuation\">:</span> animations<span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">changeAnimated</span><span class=\"token punctuation\">(</span>animated<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span><span class=\"token punctuation\">,</span> delay<span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSTimeInterval</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIViewAnimationOptions</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> changes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Void</span><span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Void</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">.</span><span class=\"token function\">animateWithDuration</span><span class=\"token punctuation\">(</span>animated <span class=\"token operator\">?</span> implicitAnimationDuration <span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> delay<span class=\"token punctuation\">:</span> delay<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> options<span class=\"token punctuation\">,</span> animations<span class=\"token punctuation\">:</span> changes<span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> completion<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here we define method that instead of animation duration accepts Bool value and creates animation with implicit duration if it is true or with zero duration if it is false (which means that changes will be not animated at all). Also we define method that accepts animation block as trailing closure ignoring completion block.</p>\n<h4>Themes</h4>\n<p>Next thing that we can extract from view controller is setting up views appearance. First we should not hardcode UIColor values in different places in our code, all colors used in application should be specified in one place. This place can be called view theme. View theme should incapsulate all colors used by particular view. View should be able to access this colors using some tags.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token class-name\">ColorTag</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">protocol</span> <span class=\"token class-name\">ColorTheme</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">colorForTag</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ColorTag</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">UIColor</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">mainColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">UIColor</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token class-name\">ColorTheme</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">mainColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">UIColor</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">UIColor</span><span class=\"token punctuation\">.</span><span class=\"token function\">whiteColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">protocol</span> <span class=\"token class-name\">ThemedView</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">class</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> theme<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ColorTheme</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">get</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">updateAppearance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here we first define protocol for <code>ColorTag</code>. It's empty protocol cause we will use it only to annotate other types that will play role of tags (i.e. enums can be used as tags). Then we define <code>ColorTheme</code> protocol that has method to access color by tag and main color property. This main color will be used as default color.<br>\nWith that we can define color theme for <code>FormTextField</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">FormTextField</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">enum</span> <span class=\"token class-name\">ThemeColorTag</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">ColorTag</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token class-name\">TintColor</span>\n        <span class=\"token keyword\">case</span> <span class=\"token class-name\">TextColor</span>\n        <span class=\"token keyword\">case</span> <span class=\"token class-name\">PlaceholderColor</span>\n        <span class=\"token keyword\">case</span> <span class=\"token class-name\">LeftViewTintColor</span>\n        <span class=\"token keyword\">case</span> <span class=\"token class-name\">RightViewTintColor</span>\n        <span class=\"token keyword\">case</span> <span class=\"token class-name\">BackgroundColor</span>\n        <span class=\"token keyword\">case</span> <span class=\"token class-name\">HighlightedBackgroundColor</span>\n        <span class=\"token keyword\">case</span> <span class=\"token class-name\">InvalidIndicatorColor</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">FormTextFieldDefaultTheme</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">ColorTheme</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">colorForTag</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ColorTag</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">UIColor</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> tag <span class=\"token operator\">=</span> tag <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token class-name\">FormTextField</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">ThemeColorTag</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">switch</span> tag <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">TextColor</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">return</span> <span class=\"token class-name\">UIColor</span><span class=\"token punctuation\">.</span><span class=\"token function\">whiteColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">PlaceholderColor</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">return</span> <span class=\"token class-name\">UIColor</span><span class=\"token punctuation\">.</span><span class=\"token function\">lightTextColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">LeftViewTintColor</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">RightViewTintColor</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">return</span> <span class=\"token class-name\">UIColor</span><span class=\"token punctuation\">.</span><span class=\"token function\">lightTextColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">BackgroundColor</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">return</span> <span class=\"token class-name\">UIColor</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">:</span> <span class=\"token number\">103.0</span><span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token punctuation\">,</span> green<span class=\"token punctuation\">:</span> <span class=\"token number\">103.0</span><span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token punctuation\">,</span> blue<span class=\"token punctuation\">:</span> <span class=\"token number\">103.0</span><span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token punctuation\">,</span> alpha<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">HighlightedBackgroundColor</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">return</span> <span class=\"token class-name\">UIColor</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">:</span> <span class=\"token number\">145.0</span><span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token punctuation\">,</span> green<span class=\"token punctuation\">:</span> <span class=\"token number\">145.0</span><span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token punctuation\">,</span> blue<span class=\"token punctuation\">:</span> <span class=\"token number\">145.0</span><span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token punctuation\">,</span> alpha<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">InvalidIndicatorColor</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">return</span> <span class=\"token class-name\">UIColor</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">:</span> <span class=\"token number\">220.0</span><span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token punctuation\">,</span> green<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> blue<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> alpha<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> mainColor\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> mainColor\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Using this theme we can make <code>FormTextFiled</code> to conform to <code>ThemedView</code> protocol.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">ThemedView</span> <span class=\"token keyword\">where</span> <span class=\"token keyword\">Self</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">FormTextField</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">attributedPlaceholder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">NSAttributedString</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> placeholder <span class=\"token operator\">=</span> placeholder <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">NSAttributedString</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">:</span> placeholder<span class=\"token punctuation\">,</span> attributes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">NSForegroundColorAttributeName</span><span class=\"token punctuation\">:</span> theme<span class=\"token punctuation\">.</span><span class=\"token function\">colorForTag</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThemeColorTag</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">PlaceholderColor</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token nil constant\">nil</span>\n    <span class=\"token punctuation\">}</span>   \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">FormTextField</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITextField</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ThemedView</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>frame<span class=\"token punctuation\">:</span> <span class=\"token class-name\">CGRect</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>frame<span class=\"token punctuation\">:</span> frame<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">initialized</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">required</span> <span class=\"token keyword\">init</span><span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>coder aDecoder<span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSCoder</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>coder<span class=\"token punctuation\">:</span> aDecoder<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">initialized</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">initialized</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        rightView <span class=\"token operator\">=</span> <span class=\"token class-name\">InvalidInputIndicator</span><span class=\"token punctuation\">(</span>textField<span class=\"token punctuation\">:</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">updateAppearance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">var</span> theme<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ColorTheme</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">FormTextFieldDefaultTheme</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">didSet</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">updateAppearance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">updateAppearance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        tintColor <span class=\"token operator\">=</span> theme<span class=\"token punctuation\">.</span><span class=\"token function\">colorForTag</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThemeColorTag</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">TintColor</span><span class=\"token punctuation\">)</span>\n        textColor <span class=\"token operator\">=</span> theme<span class=\"token punctuation\">.</span><span class=\"token function\">colorForTag</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThemeColorTag</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">TextColor</span><span class=\"token punctuation\">)</span>\n        \n        backgroundColor <span class=\"token operator\">=</span> highlighted <span class=\"token operator\">?</span>\n            theme<span class=\"token punctuation\">.</span><span class=\"token function\">colorForTag</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThemeColorTag</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">HighlightedBackgroundColor</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span>\n            theme<span class=\"token punctuation\">.</span><span class=\"token function\">colorForTag</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThemeColorTag</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">BackgroundColor</span><span class=\"token punctuation\">)</span>\n        \n        attributedPlaceholder <span class=\"token operator\">=</span> <span class=\"token function\">attributedPlaceholder</span><span class=\"token punctuation\">(</span>theme<span class=\"token punctuation\">)</span>\n        leftView<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>tintColor <span class=\"token operator\">=</span> theme<span class=\"token punctuation\">.</span><span class=\"token function\">colorForTag</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThemeColorTag</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">LeftViewTintColor</span><span class=\"token punctuation\">)</span>\n        rightView<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>tintColor <span class=\"token operator\">=</span> theme<span class=\"token punctuation\">.</span><span class=\"token function\">colorForTag</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThemeColorTag</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">RightViewTintColor</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">(</span>rightView <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token class-name\">InvalidInputIndicator</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> theme<span class=\"token punctuation\">.</span><span class=\"token function\">colorForTag</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ThemeColorTag</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">InvalidIndicatorColor</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">InvalidInputIndicator</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIView</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>textField<span class=\"token punctuation\">:</span> <span class=\"token class-name\">FormTextField</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>frame<span class=\"token punctuation\">:</span> <span class=\"token class-name\">CGRectMake</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CGRectGetHeight</span><span class=\"token punctuation\">(</span>textField<span class=\"token punctuation\">.</span>bounds<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CGRectGetHeight</span><span class=\"token punctuation\">(</span>textField<span class=\"token punctuation\">.</span>bounds<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>layer<span class=\"token punctuation\">.</span>cornerRadius <span class=\"token operator\">=</span> <span class=\"token class-name\">CGRectGetHeight</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>bounds<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">required</span> <span class=\"token keyword\">init</span><span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>coder aDecoder<span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSCoder</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">fatalError</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"init(coder:) has not been implemented\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now in view controller we only need to setup text fields' icons. As we load view from storyboard we can do it not in <code>viewDidLoad</code> but in observers of outlets for this views. When user will select or deselect text field we don't need to set it's background color manually. We can just set it's highlighted property and call <code>updateAppearance()</code> method.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIViewController</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">UITextFieldDelegate</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token attribute atrule\">@IBOutlet</span>\n    <span class=\"token keyword\">var</span> userNameInput<span class=\"token punctuation\">:</span> <span class=\"token class-name\">FormTextField</span><span class=\"token operator\">!</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">didSet</span> <span class=\"token punctuation\">{</span>\n            userNameInput<span class=\"token punctuation\">.</span>leftView <span class=\"token operator\">=</span> <span class=\"token class-name\">UIImageView</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIImage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">InputEmailIcon</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            userNameInput<span class=\"token punctuation\">.</span>leftViewMode <span class=\"token operator\">=</span> <span class=\"token class-name\">UITextFieldViewMode</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Always</span>\n            userNameInput<span class=\"token punctuation\">.</span><span class=\"token function\">updateAppearance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token attribute atrule\">@IBOutlet</span>\n    <span class=\"token keyword\">var</span> passwordInput<span class=\"token punctuation\">:</span> <span class=\"token class-name\">FormTextField</span><span class=\"token operator\">!</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">didSet</span> <span class=\"token punctuation\">{</span>\n            passwordInput<span class=\"token punctuation\">.</span>leftView <span class=\"token operator\">=</span> <span class=\"token class-name\">UIImageView</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIImage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">InputPasswordIcon</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            passwordInput<span class=\"token punctuation\">.</span>leftViewMode <span class=\"token operator\">=</span> <span class=\"token class-name\">UITextFieldViewMode</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Always</span>\n            passwordInput<span class=\"token punctuation\">.</span><span class=\"token function\">updateAppearance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">textFieldDidBeginEditing</span><span class=\"token punctuation\">(</span>textField<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITextField</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        view<span class=\"token punctuation\">.</span><span class=\"token function\">changeAnimated</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">BeginFromCurrentState</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            textField<span class=\"token punctuation\">.</span>highlighted <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n            <span class=\"token punctuation\">(</span>textField <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token class-name\">ThemedView</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateAppearance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">textFieldDidEndEditing</span><span class=\"token punctuation\">(</span>textField<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITextField</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        view<span class=\"token punctuation\">.</span><span class=\"token function\">changeAnimated</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">BeginFromCurrentState</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            textField<span class=\"token punctuation\">.</span>highlighted <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n            <span class=\"token punctuation\">(</span>textField <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token class-name\">ThemedView</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateAppearance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The same way we can define theme for login button and change it's background color by calling <code>updateAppearance()</code> when it's highlighted state changes. But I will leave if for now as it is and in the next post will show how you can solve this case differently.</p>\n<p>####Root view</p>\n<p>Currently we have our layout defined in a storyboard. Though it can be the easiest way for small applications I think that for large projects it's better to use separate xib files for each view to define layout and to use storyboards only to define workflow. Though you can say that workflow is tightly coupled with layout (and you will be probably right) I still think that it's nice to separate them. I worked on one project with bunch of screens where almost every view and all transitions were defined in one storyboard. It was a mess. To clean it up I broke it into smaller storyboards (<a href=\"http://ilya.puchka.me/ios-storyboards-segregation/\">here</a> you can read how, but iOS 9 introduces storyboards references so it should be easier now to achieve the same result). This made my life a bit easier but I still had a huge table view controller in one storyboard with ten or more cell prototypes and segues attached to them or to their subviews. It was very hard to manage. Some of my colleagues prefer not to use Interface Builder at all, but I think it is just another extreme.</p>\n<p>We will not only move layout to separate xib file but we also will create UIView subclass for the root view. Then we can move all the code that manages subviews (text fields and buttons) there. The thing is that we easily create subclasses for our UI components like table view controllers, buttons, text fields. But almost never I've seen anyone creating subclass for root view and making it to manage it's subviews and their presentation logic instead of it's view controller. View controller should not know about any internals of it's root view, like it's subviews, their constraints or animations. View controller should only manage it's lifecycle and act as mediator between different components of business logic and presentation logic. View in turn should provide interface to change it or ask it for it's state.</p>\n<p>To use xib file and storyboard at the same time you need few things. Fist delete root view from view controller in storyboard and override it's 'nibName' property:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIViewController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">var</span> nibName<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string-literal\"><span class=\"token string\">\"AuthView\"</span></span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then in <em>AuthView.xib</em> you need to set <em>File's Owner</em> to <code>ViewController</code> and connect root view with it's view outlet. This way when system will load storyboard it will use <em>AuthView.xib</em> to load root view and will set it's root view element as view property of view controller.</p>\n<p>Now we can move all outlets, text view delegate callbacks and buttons actions to <code>AuthView</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthView</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">UITextFieldDelegate</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>frame<span class=\"token punctuation\">:</span> <span class=\"token class-name\">CGRect</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>frame<span class=\"token punctuation\">:</span> frame<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEndEditingTapRecognizer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">required</span> <span class=\"token keyword\">init</span><span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>coder aDecoder<span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSCoder</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>coder<span class=\"token punctuation\">:</span> aDecoder<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEndEditingTapRecognizer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">lazy</span> <span class=\"token keyword\">var</span> endEditingTapRecognizer<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITapGestureRecognizer</span><span class=\"token operator\">!</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">UITapGestureRecognizer</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">:</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"endEditing\"</span></span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">addEndEditingTapRecognizer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">addGestureRecognizer</span><span class=\"token punctuation\">(</span>endEditingTapRecognizer<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token attribute atrule\">@objc</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">endEditing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">endEditing</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token attribute atrule\">@IBOutlet</span>\n    <span class=\"token keyword\">var</span> userNameInput<span class=\"token punctuation\">:</span> <span class=\"token class-name\">FormTextField</span><span class=\"token operator\">!</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">didSet</span> <span class=\"token punctuation\">{</span>\n            userNameInput<span class=\"token punctuation\">.</span>leftView <span class=\"token operator\">=</span> <span class=\"token class-name\">UIImageView</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIImage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">InputEmailIcon</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            userNameInput<span class=\"token punctuation\">.</span>leftViewMode <span class=\"token operator\">=</span> <span class=\"token class-name\">UITextFieldViewMode</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Always</span>\n            userNameInput<span class=\"token punctuation\">.</span><span class=\"token function\">updateAppearance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token attribute atrule\">@IBOutlet</span>\n    <span class=\"token keyword\">var</span> passwordInput<span class=\"token punctuation\">:</span> <span class=\"token class-name\">FormTextField</span><span class=\"token operator\">!</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">didSet</span> <span class=\"token punctuation\">{</span>\n            passwordInput<span class=\"token punctuation\">.</span>leftView <span class=\"token operator\">=</span> <span class=\"token class-name\">UIImageView</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIImage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">InputPasswordIcon</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            passwordInput<span class=\"token punctuation\">.</span>leftViewMode <span class=\"token operator\">=</span> <span class=\"token class-name\">UITextFieldViewMode</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Always</span>\n            passwordInput<span class=\"token punctuation\">.</span><span class=\"token function\">updateAppearance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token attribute atrule\">@IBOutlet</span>\n    <span class=\"token keyword\">var</span> loginButton<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIButton</span><span class=\"token operator\">!</span>\n\n    <span class=\"token attribute atrule\">@IBAction</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">loginButtonTapped</span><span class=\"token punctuation\">(</span>sender<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIButton</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">endEditing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">.</span><span class=\"token function\">animateWithDuration</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.25</span><span class=\"token punctuation\">,</span> delay<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">UIViewAnimationOptions</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">BeginFromCurrentState</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> animations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Void</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>loginButton<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token class-name\">UIColor</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> green<span class=\"token punctuation\">:</span> <span class=\"token number\">122.0</span><span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token punctuation\">,</span> blue<span class=\"token punctuation\">:</span> <span class=\"token number\">255.0</span><span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token punctuation\">,</span> alpha<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token attribute atrule\">@IBAction</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">loginButtonTouchBegin</span><span class=\"token punctuation\">(</span>sender<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIButton</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">.</span><span class=\"token function\">animateWithDuration</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.25</span><span class=\"token punctuation\">,</span> delay<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">UIViewAnimationOptions</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">BeginFromCurrentState</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> animations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Void</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>loginButton<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token class-name\">UIColor</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">:</span> <span class=\"token number\">21.0</span><span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token punctuation\">,</span> green<span class=\"token punctuation\">:</span> <span class=\"token number\">160.0</span><span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token punctuation\">,</span> blue<span class=\"token punctuation\">:</span> <span class=\"token number\">255.0</span><span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token punctuation\">,</span> alpha<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token attribute atrule\">@IBAction</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">forgottenPasswordTapped</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">endEditing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">textFieldDidBeginEditing</span><span class=\"token punctuation\">(</span>textField<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITextField</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">changeAnimated</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">BeginFromCurrentState</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            textField<span class=\"token punctuation\">.</span>highlighted <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n            <span class=\"token punctuation\">(</span>textField <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token class-name\">ThemedView</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateAppearance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">textFieldDidEndEditing</span><span class=\"token punctuation\">(</span>textField<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITextField</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">changeAnimated</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">BeginFromCurrentState</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            textField<span class=\"token punctuation\">.</span>highlighted <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n            <span class=\"token punctuation\">(</span>textField <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token class-name\">ThemedView</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateAppearance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">textFieldShouldReturn</span><span class=\"token punctuation\">(</span>textField<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITextField</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> textField <span class=\"token operator\">==</span> userNameInput <span class=\"token punctuation\">{</span>\n            passwordInput<span class=\"token punctuation\">.</span><span class=\"token function\">becomeFirstResponder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">endEditing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            onLoginButtonTapped<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span><span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">var</span> shakeAnimation<span class=\"token punctuation\">:</span> <span class=\"token class-name\">CAKeyframeAnimation</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> animation <span class=\"token operator\">=</span> <span class=\"token class-name\">CAKeyframeAnimation</span><span class=\"token punctuation\">(</span>keyPath<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"position.x\"</span></span><span class=\"token punctuation\">)</span>\n        animation<span class=\"token punctuation\">.</span>values <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n        animation<span class=\"token punctuation\">.</span>keyTimes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">6.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">/</span> <span class=\"token number\">6.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5</span> <span class=\"token operator\">/</span> <span class=\"token number\">6.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n        animation<span class=\"token punctuation\">.</span>duration <span class=\"token operator\">=</span> <span class=\"token number\">0.2</span>\n        animation<span class=\"token punctuation\">.</span>additive <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n        <span class=\"token keyword\">return</span> animation\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">markUserNameAsInvalid</span><span class=\"token punctuation\">(</span>invalid<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">markTextField</span><span class=\"token punctuation\">(</span>userNameInput<span class=\"token punctuation\">,</span> asInvalid<span class=\"token punctuation\">:</span> invalid<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">markPasswordAsInvalid</span><span class=\"token punctuation\">(</span>invalid<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">markTextField</span><span class=\"token punctuation\">(</span>passwordInput<span class=\"token punctuation\">,</span> asInvalid<span class=\"token punctuation\">:</span> invalid<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">markTextField</span><span class=\"token punctuation\">(</span>textField<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITextField</span><span class=\"token punctuation\">,</span> asInvalid invalid<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> invalid <span class=\"token punctuation\">{</span>\n            textField<span class=\"token punctuation\">.</span>rightViewMode <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">Always</span>\n            textField<span class=\"token punctuation\">.</span>layer<span class=\"token punctuation\">.</span><span class=\"token function\">addAnimation</span><span class=\"token punctuation\">(</span>shakeAnimation<span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"shake\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            textField<span class=\"token punctuation\">.</span>rightViewMode <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">Never</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Notice that we also moved animations in view itself. View controller will call provided methods to mark input fields as invalid but it will be view how will decide how to present it to user.</p>\n<p>Now view controller does not care about presentation logic of it's root view, it's subviews (we can even make them private if we want) and their animations. But also now there is no way for it to know that button was tapped. At the same time we should not add business logic (performing user login) to view. We can solve this simply by defining closure property on <code>AuthView</code> that it will call when we need to perform action on login button. View controller will set this closure to call it's <code>login</code> method. It is similar to what we've used to do in Objective-C with delegate pattern but it's simpler cause we don't need additional protocol for that. The same way we could add closure to respond to \"Forgotten password\" button but I will skip this.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthView</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">UITextFieldDelegate</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token keyword\">var</span> onLoginButtonTapped<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Void</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span>\n    \n    <span class=\"token attribute atrule\">@IBAction</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">loginButtonTapped</span><span class=\"token punctuation\">(</span>sender<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIButton</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">endEditing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">.</span><span class=\"token function\">animateWithDuration</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.25</span><span class=\"token punctuation\">,</span> delay<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">UIViewAnimationOptions</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">BeginFromCurrentState</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> animations<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Void</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>loginButton<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token class-name\">UIColor</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> green<span class=\"token punctuation\">:</span> <span class=\"token number\">122.0</span><span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token punctuation\">,</span> blue<span class=\"token punctuation\">:</span> <span class=\"token number\">255.0</span><span class=\"token operator\">/</span><span class=\"token number\">255.0</span><span class=\"token punctuation\">,</span> alpha<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span>\n\n        onLoginButtonTapped<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">:</span> userNameInput<span class=\"token punctuation\">.</span>text<span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> passwordInput<span class=\"token punctuation\">.</span>text<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">textFieldShouldReturn</span><span class=\"token punctuation\">(</span>textField<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITextField</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> textField <span class=\"token operator\">==</span> userNameInput <span class=\"token punctuation\">{</span>\n            passwordInput<span class=\"token punctuation\">.</span><span class=\"token function\">becomeFirstResponder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">endEditing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            onLoginButtonTapped<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">:</span> userNameInput<span class=\"token punctuation\">.</span>text<span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> passwordInput<span class=\"token punctuation\">.</span>text<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIViewController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token keyword\">var</span> authView<span class=\"token punctuation\">:</span> <span class=\"token class-name\">AuthView</span><span class=\"token operator\">!</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> view <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token class-name\">AuthView</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        authView<span class=\"token punctuation\">.</span>onLoginButtonTapped <span class=\"token operator\">=</span> login\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">login</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">:</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        apiClient<span class=\"token punctuation\">.</span><span class=\"token function\">login</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> password<span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> onLoggedIn<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Have you noticed how many stuff already we have moved away from view controller? Now it manages only some of view setup and business logic. Most of presentation logic have moved to view itself. And I'm sure this is the right place for it. Even if you have complex view with lot's of stuff that should change on different events coming from different parts of your app, like for example constraints, they should not be changed or accessed by view controller directly. There should be API for that provided by UIView subclass. It is commonly said that view controllers are hard to test cause of their complex lifecycle. Views have much more simple lifecycle so they are better candidates for testing and handling presentation logic. Stay tuned and check out next parts of this series.</p>\n<hr>\n<ol>\n<li>Unfortunately it looks like you can't use <code>UI_APPEARANCE_SELECTOR</code> together with <code>IBInspectable</code> which will be ignored for properties marked with <code>UI_APPEARANCE_SELECTOR</code>. That means that you can setup views properties either with UIAppearance proxy or with Interface Builder, not with both at the same time.â†©ï¸Ž</li>\n</ol>","fields":{"slug":"/view-controller-thinning/"},"frontmatter":{"id":"5b6f5a3a9d28c70f0f015f67","title":"View controller thinning","date":"September 26, 2015","description":"\"Massive view controller\" is one of the most favorite topic for iOS developers when they talk about architecture. A lot have been said on this topic already, even more will be said in future cause unfortunately there is no silver bullet and view controller still stay massive in many projects. Recently Andy Matuschak presented here and there a live coding session on this topic. So you can see it's a well know and still actual problem.","tags":""}},"previous":{"excerpt":"When it comes to dependency management in Cocoa world you have three options: Cocoapods Carthage Don's use dependency management First one, Cocoapods, have beenâ€¦","fields":{"slug":"/path-to-carthage-real-life-experience/"},"frontmatter":{"title":"Path to Carthage. Real-life experience.","date":"September 21, 2015"}},"next":{"excerpt":"In my previous post you could see that I've used ColorTheme and ThemedView protocol to easily customize view appearance. Though that solution works I was notâ€¦","fields":{"slug":"/view-themes/"},"frontmatter":{"title":"View themes","date":"October 03, 2015"}}},"pageContext":{"id":"35dff8c7-ea1c-5e75-aeb4-a8fca13e44f5","previousPostId":"d8288d2a-734e-56d4-bdcb-3a150899aa92","nextPostId":"069f3b34-7271-53c8-8e60-5e2793ed87e0"}},"staticQueryHashes":["2355076697","2841359383"],"slicesMap":{}}