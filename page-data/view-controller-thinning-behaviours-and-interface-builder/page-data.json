{"componentChunkName":"component---src-templates-blog-post-js","path":"/view-controller-thinning-behaviours-and-interface-builder/","result":{"data":{"site":{"siteMetadata":{"title":"Ilya Puchka","siteUrl":"https://ilya.puchka.me"}},"markdownRemark":{"id":"d76806a0-7d65-56cd-aab9-d6823bb19d58","excerpt":"In previous post I showed how you can move some presentation logic from view controller to view. Now view controller is responsible only for business logic, inâ€¦","html":"<p>In <a href=\"http://ilya.puchka.me/view-controller-thinning/\">previous post</a> I showed how you can move some presentation logic from view controller to view. Now view controller is responsible only for business logic, in this case making login request and handling its result. But now you would say: \"You just moved presentation logic from controller to view. Now you have Massive View!\" And you will be right. Though view is a perfect place for presentation logic that leads to that view should know everything about its subviews and it will probably change when we change something in its subviews. So in this post I will show how to make view a little bit less aware of its subviews details and how to isolate business logic from everything else. You can follow commits history in this <a href=\"https://github.com/ilyapuchka/ViewControllerThinning/commits/master\">repo</a>.</p>\n<h4>Behaviors</h4>\n<p>And this brings us to the concept of <em>behaviors</em>. What makes difference between values and objects is that values are inert but objects <em>behave</em>. They do something and change when you tell them. If what your object does is just some calculations than it's probably better to be a value. If your value needs to perform some <em>action</em> apart from manipulation with its data than it's probably better to be an object. But does the behavior need to be defined in object itself? It is now. <code>AuthView</code> now defines how its subviews should behave when user taps on them or when the user input is invalid. In most cases it will be fine and acceptable. But if because of that your view becomes to complex then it's probably time to refactor and to let the behaviors a green light.</p>\n<p>First I will define what are those behaviours in case of <code>AuthView</code>. The most obvious one is highlighting behavior. When user taps on a button or when it changes input context from one text field to another these views change there background color. Cool, what's next? When user press login button and his input is invalid text fields should \"shake\". That's also a behavior - in response to user input I add some animation to views. The last behavior is <em>form</em> behavior. It defines what should happen when on for example pressing \"Return\" button on keyboard, should user move from one field to another or it will just hide the keyboard, in what order this move should happen, on what button the form is submitted or discarded.</p>\n<h4>Highlight behavior</h4>\n<p>For this behavior I need to provide few things - background color for normal state, background color for highlighted state, setter for background color and setter for highlighted state. <code>UITextField</code> and <code>UIButton</code> already has properties like background color and highlighted. What's missing is ability to set background colors for different highlight state. First I will define protocol <code>BackgroundHighlightableView</code> that will provide interface required for this behavior.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token class-name\">BackgroundHighlightableView</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">class</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> backgroundColor<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIColor</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">get</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">var</span> backgroundColorForHighlightedState<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIColor</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">var</span> backgroundColorForNormalState<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIColor</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">var</span> highlighted<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">get</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">setHighlighted</span><span class=\"token punctuation\">(</span>highlighted<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span><span class=\"token punctuation\">,</span> animated<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">backgroundColor</span><span class=\"token punctuation\">(</span>highlighted<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">UIColor</span><span class=\"token operator\">?</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here I define only getters for <code>backgroundColorForHighlightedState</code> and <code>backgroundColorForNormalState</code> cause I'm not gonna use this protocol to change this properties, but in concrete implementation I will provide those setters.</p>\n<p>Next I will define extension for this protocol when it's applied to UIView (it make less sense to apply it on anything else but we can not restrict protocol to be applied on specific types) that will provide default implementation of protocol's methods.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">BackgroundHighlightableView</span> <span class=\"token keyword\">where</span> <span class=\"token keyword\">Self</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIView</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">setHighlighted</span><span class=\"token punctuation\">(</span>highlighted<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span><span class=\"token punctuation\">,</span> animated<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> view <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">UIView</span>\n        <span class=\"token keyword\">guard</span> backgroundColorForHighlightedState <span class=\"token operator\">!=</span> <span class=\"token nil constant\">nil</span> <span class=\"token operator\">&amp;&amp;</span>\n            view<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">!=</span> <span class=\"token nil constant\">nil</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">changeAnimated</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">BeginFromCurrentState</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            view<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">backgroundColor</span><span class=\"token punctuation\">(</span>highlighted<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">backgroundColor</span><span class=\"token punctuation\">(</span>highlighted<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">UIColor</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> highlighted <span class=\"token operator\">?</span> backgroundColorForHighlightedState <span class=\"token punctuation\">:</span> backgroundColorForNormalState\n    <span class=\"token punctuation\">}</span>\n    \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Note that I had to use <code>let view = self as UIView</code> (or I could use <code>let view = self as BackgroundHighlightableView</code>). I need it cause protocol and UIView both define <code>backgroundColor</code> property and for Swift referencing it with <code>self</code> will be ambiguous.</p>\n<p>Now I can use this protocol to create subclass of <code>UIButton</code> that will conform to it.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">HighlightableButton</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIButton</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">BackgroundHighlightableView</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token attribute atrule\">@IBInspectable</span>\n    <span class=\"token keyword\">var</span> backgroundColorForHighlightedState<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIColor</span><span class=\"token operator\">?</span>\n    \n    <span class=\"token keyword\">var</span> backgroundColorForNormalState<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIColor</span><span class=\"token operator\">?</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">var</span> backgroundColor<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIColor</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">didSet</span> <span class=\"token punctuation\">{</span>\n            backgroundColorForNormalState <span class=\"token operator\">=</span> backgroundColorForNormalState <span class=\"token operator\">??</span> backgroundColor\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">var</span> highlighted<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">willSet</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">setHighlighted</span><span class=\"token punctuation\">(</span>newValue<span class=\"token punctuation\">,</span> animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>For text filed I already have a subclass - <code>FormTextField</code>, so I can extend it and add conformance to <code>BackgroundHighlightableView</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">FormTextField</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">BackgroundHighlightableView</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token keyword\">var</span> backgroundColorForHighlightedState<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIColor</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">get</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>theme<span class=\"token punctuation\">.</span>highlightedBackgroundColor\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">var</span> backgroundColorForNormalState<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIColor</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">get</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>theme<span class=\"token punctuation\">.</span>backgroundColor\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">var</span> highlighted<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">willSet</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">setHighlighted</span><span class=\"token punctuation\">(</span>newValue<span class=\"token punctuation\">,</span> animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">resignFirstResponder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> resignedFirstResponder <span class=\"token operator\">=</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">resignFirstResponder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        highlighted <span class=\"token operator\">=</span> <span class=\"token operator\">!</span>resignedFirstResponder\n        <span class=\"token keyword\">return</span> resignedFirstResponder\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">becomeFirstResponder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> becameFirstResponder <span class=\"token operator\">=</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">becomeFirstResponder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        highlighted <span class=\"token operator\">=</span> becameFirstResponder\n        <span class=\"token keyword\">return</span> becameFirstResponder\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You can see the difference. In <code>HighlightableButton</code> I used <code>IBInspectable</code> property to set <code>backgroundColorForHighlightedState</code>. Here I use theme to provide background colors for different states.</p>\n<h4>Animations</h4>\n<p>To define animation I need its duration, view to apply it on and method to apply it.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token attribute atrule\">@objc</span>\n<span class=\"token keyword\">protocol</span> <span class=\"token class-name\">Animation</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> duration<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">var</span> view<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIView</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token class-name\">Animation</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">fatalError</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Concrete instances of Animation protocol should provide implementation of this method.\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here I mark <code>Animation</code> protocol as <code>@objc</code> so that later I can use concrete implementation of this protocol as <code>IBOutlet</code>. If I would use it only in code it's not required. But since I mark the whole protocol with <code>@objc</code> each method will be implicitly marked with <code>@objc</code>. Then I will not be able to define default implementation for <code>play()</code> method in protocol extension (what I will do in a minute), because it's not supported yet. That's why I removed <code>play()</code> method from protocol declaration to its extension and defined implementation with assertion. I will override it anyway.</p>\n<p>Next I will define more concrete protocol that will describe \"shake\" animation.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token attribute atrule\">@objc</span>\n<span class=\"token keyword\">protocol</span> <span class=\"token class-name\">ShakeAnimation</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Animation</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> maxOffset<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">get</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">var</span> keyPath<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">get</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token class-name\">ShakeAnimation</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> view <span class=\"token operator\">=</span> view <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">}</span>\n        \n        <span class=\"token keyword\">let</span> animation <span class=\"token operator\">=</span> <span class=\"token class-name\">CAKeyframeAnimation</span><span class=\"token punctuation\">(</span>keyPath<span class=\"token punctuation\">:</span> keyPath<span class=\"token punctuation\">)</span>\n        animation<span class=\"token punctuation\">.</span>values <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> maxOffset<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0.8</span> <span class=\"token operator\">*</span> maxOffset<span class=\"token punctuation\">,</span> <span class=\"token number\">0.4</span> <span class=\"token operator\">*</span> maxOffset<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n        animation<span class=\"token punctuation\">.</span>keyTimes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">6.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">/</span> <span class=\"token number\">6.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5</span> <span class=\"token operator\">/</span> <span class=\"token number\">6.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n        animation<span class=\"token punctuation\">.</span>duration <span class=\"token operator\">=</span> duration <span class=\"token operator\">??</span> view<span class=\"token punctuation\">.</span>implicitAnimationDuration\n        animation<span class=\"token punctuation\">.</span>additive <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n        view<span class=\"token punctuation\">.</span>layer<span class=\"token punctuation\">.</span><span class=\"token function\">addAnimation</span><span class=\"token punctuation\">(</span>animation<span class=\"token punctuation\">,</span> forKey<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"shake\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It's again marked with <code>@objc</code> to be used in Interface Builder. Here I define a keyPath that will be animated. I don't care if it is \"position.x\" or \"position.y\" or even \"transform.rotation.z\", I let clients of this protocol to define that. And I provide default implementation of \"shake\" animation which is pretty straight forward.</p>\n<p>Now I need concrete implementation of <code>ShakeAnimation</code> protocol. I already have default implementation of <code>play()</code> function, so I need only to define properties and their default values.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ShakeAnimationImp</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSObject</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ShakeAnimation</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token attribute atrule\">@IBInspectable</span>\n    <span class=\"token keyword\">var</span> duration<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.2</span>\n    \n    <span class=\"token attribute atrule\">@IBInspectable</span>\n    <span class=\"token keyword\">var</span> maxOffset<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span>\n    \n    <span class=\"token attribute atrule\">@IBInspectable</span>\n    <span class=\"token keyword\">var</span> keyPath<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span> <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"position.x\"</span></span>\n    \n    <span class=\"token attribute atrule\">@IBOutlet</span>\n    <span class=\"token keyword\">weak</span> <span class=\"token keyword\">var</span> view<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIView</span><span class=\"token operator\">?</span>\n    \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now I need to hook it up with view. To do that I will use Interface Builder. I need just to drag two objects of <code>ShakeAnimationImp</code> in <code>AuthView</code> xib and connect their view outlets with each of text fields. In <code>FormTextField</code> itself I need to have reference to animation object to call its <code>play()</code> method when I need to, so I will just add outlet for that property and will connect it with animation objects. I will add <code>invalidInput</code> property to <code>FormTextField</code> to incapsulate this behavior in view itself.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token attribute atrule\">@IBOutlet</span>\n<span class=\"token keyword\">var</span> shakeAnimation<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ShakeAnimation</span><span class=\"token operator\">?</span>\n\n<span class=\"token keyword\">var</span> invalidInput<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">didSet</span> <span class=\"token punctuation\">{</span>\n        rightViewMode <span class=\"token operator\">=</span> invalidInput <span class=\"token operator\">?</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">Always</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">Never</span>\n        <span class=\"token keyword\">if</span> invalidInput <span class=\"token punctuation\">{</span>\n            shakeAnimation<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now view controller only needs to call <code>authView.userNameInput.invalidInput = true|false</code> to trigger animation and show/hide invalid input indicator.</p>\n<h4>Form behavior</h4>\n<p>The last behavior that I will add is form behavior. Each form should have fields, optional current field, method to move user input focus to the next field and methods to submit form or to cancel.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token class-name\">FormBehaviour</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> formFields<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">UIView</span><span class=\"token punctuation\">]</span><span class=\"token operator\">!</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">goToNextFormField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">UIView</span><span class=\"token operator\">?</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">currentFormField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">UIView</span><span class=\"token operator\">?</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">submitForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">cancelForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Note that <code>formFields</code> is defined as explicitly unwrapped optional property and not a function because I want to use it in Interface Builder again and want be able to use IBOutlet collection for this property. If I would use method like <code>formField() -> [UIView]</code> to use this protocol with InterfaceBuilder I would need to define property with some other name (Swift will not let you define property and at the same type function with no arguments, the same return type as property type and the same name as property) and return its value in this method.</p>\n<p>It's very likely that each form will have the same logic for moving from one field to another, so here I can use protocol extension again and define default implementation, shared among all kinds of forms. Property for current field can be also implemented in this extension cause only the field which is a first responder can be current.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">FormBehavior</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">currentFormField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">UIView</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span> field <span class=\"token keyword\">in</span> formFields <span class=\"token keyword\">where</span> field<span class=\"token punctuation\">.</span><span class=\"token function\">isFirstResponder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> field\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token nil constant\">nil</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">goToNextFormField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">UIView</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span>\n            formFields <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>formFields<span class=\"token punctuation\">,</span>\n            currentField <span class=\"token operator\">=</span> <span class=\"token function\">currentFormField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            currentFieldIndex <span class=\"token operator\">=</span> formFields<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>currentField<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">where</span>\n            formFields<span class=\"token punctuation\">.</span>count <span class=\"token operator\">></span> <span class=\"token number\">1</span>\n            <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token nil constant\">nil</span>\n        <span class=\"token punctuation\">}</span>\n        \n        <span class=\"token keyword\">var</span> nextFormField<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIView</span><span class=\"token operator\">!</span> <span class=\"token operator\">=</span> <span class=\"token nil constant\">nil</span>\n        <span class=\"token keyword\">var</span> nextIndex <span class=\"token operator\">=</span> currentFieldIndex\n        <span class=\"token keyword\">repeat</span> <span class=\"token punctuation\">{</span>\n            nextIndex <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>nextIndex <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> formFields<span class=\"token punctuation\">.</span>count\n            nextFormField <span class=\"token operator\">=</span> formFields<span class=\"token punctuation\">[</span>nextIndex<span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">while</span> nextFormField<span class=\"token punctuation\">.</span><span class=\"token function\">canBecomeFirstResponder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token boolean\">false</span> <span class=\"token operator\">&amp;&amp;</span> nextIndex <span class=\"token operator\">!=</span> currentFieldIndex\n        <span class=\"token keyword\">if</span> nextIndex <span class=\"token operator\">!=</span> currentFieldIndex <span class=\"token punctuation\">{</span>\n            nextFormField<span class=\"token punctuation\">.</span><span class=\"token function\">becomeFirstResponder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> nextFormField\n    <span class=\"token punctuation\">}</span>\n    \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Next I need to define behavior specific to user login form. Here I have two options - to define this behavior as protocol and conform to it in view controller or to define a separate object that conforms to <code>FormBehavior</code> and use composition in view controller by referencing this object in property. First one is very tempting but that will lead me away from initial goal - to remove stuff from view controller. Also it will be harder to test this behavior cause it will require view controller (I still tried that way and you can check out code for this path in this <a href=\"https://github.com/ilyapuchka/ViewControllerThinning/tree/auth-behaviour-as-protocol\">branch</a>). So the latter path looks preferable. It will let me later to test this behavior independently from view controller and I will be able to use Interface Builder to inject it in view controller.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthFormBehaviour</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSObject</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">FormBehaviour</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token keyword\">var</span> apiClient<span class=\"token punctuation\">:</span> <span class=\"token class-name\">APIClient</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">APIClient</span><span class=\"token punctuation\">(</span>baseURL<span class=\"token punctuation\">:</span> <span class=\"token function\">NSURL</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"http://localhost\"</span></span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token attribute atrule\">@IBOutlet</span>\n    <span class=\"token keyword\">var</span> userNameInput<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITextField</span><span class=\"token operator\">!</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">didSet</span> <span class=\"token punctuation\">{</span>\n            userNameInput<span class=\"token punctuation\">.</span>delegate <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token attribute atrule\">@IBOutlet</span>\n    <span class=\"token keyword\">var</span> passwordInput<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITextField</span><span class=\"token operator\">!</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">didSet</span> <span class=\"token punctuation\">{</span>\n            passwordInput<span class=\"token punctuation\">.</span>delegate <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token attribute atrule\">@IBOutlet</span>\n    <span class=\"token keyword\">var</span> formFields<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">UIView</span><span class=\"token punctuation\">]</span><span class=\"token operator\">!</span>\n    \n    <span class=\"token attribute atrule\">@IBAction</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">submitForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span>\n            username <span class=\"token operator\">=</span> userNameInput<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">,</span>\n            password <span class=\"token operator\">=</span> passwordInput<span class=\"token punctuation\">.</span>text <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n        userNameInput<span class=\"token punctuation\">.</span><span class=\"token function\">endEditing</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n        passwordInput<span class=\"token punctuation\">.</span><span class=\"token function\">endEditing</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">login</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> password<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">var</span> onCancel<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span>\n    \n    <span class=\"token attribute atrule\">@IBAction</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">cancelForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        onCancel<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">var</span> onLoggedIn<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSError</span><span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> performedRequest<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">login</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        apiClient<span class=\"token punctuation\">.</span><span class=\"token function\">login</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> password<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">weak</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">,</span> performedRequest<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">self</span><span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>onLoggedIn<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">:</span> error<span class=\"token punctuation\">,</span> performedRequest<span class=\"token punctuation\">:</span> performedRequest<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token class-name\">AuthFormBehaviour</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITextFieldDelegate</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">textFieldShouldReturn</span><span class=\"token punctuation\">(</span>textField<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITextField</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> textField <span class=\"token operator\">==</span> formFields<span class=\"token punctuation\">.</span>last <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">submitForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">goToNextFormField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Everything is very straight forward here. I define that when form is submitted login request is performed and when it finishes I call <code>onLoggedIn</code> handler.</p>\n<p>Now I can add this object in <code>AuthView</code> xib, connect its outlets and actions. Only thing that I need to add in view controller is a property to hold this behavior and set up its <code>onLoggedIn</code> handler.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token attribute atrule\">@IBOutlet</span>\n<span class=\"token keyword\">var</span> formBehavior<span class=\"token punctuation\">:</span> <span class=\"token class-name\">AuthFormBehavior</span><span class=\"token operator\">!</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">didSet</span> <span class=\"token punctuation\">{</span>\n        formBehavior<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>onLoggedIn <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span><span class=\"token keyword\">unowned</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">in</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">handleLogin</span><span class=\"token punctuation\">(</span><span class=\"token short-argument\">$0</span><span class=\"token punctuation\">,</span> performedRequest<span class=\"token punctuation\">:</span> <span class=\"token short-argument\">$1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Clean up</h4>\n<p>The code looks much more cleaner already. To clean up view controller completely I will refactor error handling.<br>\nThe only thing that view controller should do when login completes is to display error message if there was error and say to input fields that they have invalid input. It should not inspect error for that. Instead I can provide extension of <code>NSError</code> with methods that will determine what kind of error I have.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">NSError</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token keyword\">var</span> underlyingError<span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSError</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> userInfo<span class=\"token punctuation\">[</span><span class=\"token class-name\">NSUnderlyingErrorKey</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token class-name\">NSError</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">var</span> userReadableMessage<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> userInfo<span class=\"token punctuation\">[</span><span class=\"token class-name\">NSLocalizedDescriptionKey</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token class-name\">String</span> <span class=\"token operator\">??</span> <span class=\"token class-name\">NSLocalizedString</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Something went wrong.\"</span></span><span class=\"token punctuation\">,</span> comment<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">var</span> alertMessage<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> userReadableMessage\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">isInvalidUserNameError</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> domain <span class=\"token operator\">==</span> <span class=\"token class-name\">NetworkErrorDomain</span> <span class=\"token operator\">&amp;&amp;</span> underlyingError<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>code <span class=\"token operator\">==</span> <span class=\"token class-name\">NetworkErrorCode</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">InvalidUserName</span><span class=\"token punctuation\">.</span>rawValue\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">isInvalidPasswordError</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> domain <span class=\"token operator\">==</span> <span class=\"token class-name\">NetworkErrorDomain</span> <span class=\"token operator\">&amp;&amp;</span> underlyingError<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>code <span class=\"token operator\">==</span> <span class=\"token class-name\">NetworkErrorCode</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">InvalidPassword</span><span class=\"token punctuation\">.</span>rawValue\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token class-name\">UIViewController</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">displayError</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSError</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> alert <span class=\"token operator\">=</span> <span class=\"token class-name\">UIAlertController</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSLocalizedString</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Error\"</span></span><span class=\"token punctuation\">,</span> comment<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">:</span> error<span class=\"token punctuation\">.</span>alertMessage<span class=\"token punctuation\">,</span> preferredStyle<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIAlertControllerStyle</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Alert</span><span class=\"token punctuation\">)</span>\n        alert<span class=\"token punctuation\">.</span><span class=\"token function\">addAction</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UIAlertAction</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSLocalizedString</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Close\"</span></span><span class=\"token punctuation\">,</span> comment<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> style<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIAlertActionStyle</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Cancel</span><span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">:</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">presentViewController</span><span class=\"token punctuation\">(</span>alert<span class=\"token punctuation\">,</span> animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> completion<span class=\"token punctuation\">:</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here I also define extension for <code>UIViewController</code> with method to display basic alert.</p>\n<h4>Conclusion</h4>\n<p>As you can see the original code changed a lot by this point. You could say that now there is much more code to support (and test). Yes, but as for me this code makes more sense, it's easy to follow though it's modular, it's testable, and what's more important, business logic is separated from everything else. I also heavily used Interface Builder to connect different components with each other. I could achieve the same result with code (and in next post I will show how) what has some advantages but with option to use Interface Builder, like it or not, we have more flexibility in how we implement things.</p>","fields":{"slug":"/view-controller-thinning-behaviours-and-interface-builder/"},"frontmatter":{"id":"5b6f5a3a9d28c70f0f015f69","title":"View controller thinning. Behaviors and Interface Builder.","date":"October 10, 2015","description":"In previous post I showed how you can move some presentation logic from view controller to view. Now view controller is responsible only for business logic, in this case making login request and handling its result. But now you would say: \"You just moved presentation logic from controller to view. Now you have Massive View!\" And you will be right. Though view is a perfect place for presentation logic that leads to that view should know everything about its subviews and it will probably change when we change something in its subviews. So in this post I will show how to make view a little bit less aware of its subviews details and how to isolate business logic from everything else.","tags":""}},"previous":{"excerpt":"In my previous post you could see that I've used ColorTheme and ThemedView protocol to easily customize view appearance. Though that solution works I was notâ€¦","fields":{"slug":"/view-themes/"},"frontmatter":{"title":"View themes","date":"October 03, 2015"}},"next":{"excerpt":"In my previous post I described how you can break business and presentation logic in small PONSO's to achieve better separation of concerns and think viewâ€¦","fields":{"slug":"/view-controller-thinning-dependency-injection/"},"frontmatter":{"title":"View controller thinning. Dependency injection with Typhoon.","date":"October 27, 2015"}}},"pageContext":{"id":"d76806a0-7d65-56cd-aab9-d6823bb19d58","previousPostId":"069f3b34-7271-53c8-8e60-5e2793ed87e0","nextPostId":"3000126a-7b9c-5297-a86f-115d5d881ed7"}},"staticQueryHashes":["2355076697","2841359383"],"slicesMap":{}}