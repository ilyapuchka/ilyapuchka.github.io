{"componentChunkName":"component---src-templates-blog-post-js","path":"/view-controller-thinning-dependency-injection/","result":{"data":{"site":{"siteMetadata":{"title":"Ilya Puchka","siteUrl":"https://ilya.puchka.me"}},"markdownRemark":{"id":"3000126a-7b9c-5297-a86f-115d5d881ed7","excerpt":"In my previous post I described how you can break business and presentation logic in small PONSO's to achieve better separation of concerns and think view…","html":"<p>In my <a href=\"http://ilya.puchka.me/view-controller-thinning-behaviours-and-interface-builder/\">previous post</a> I described how you can break business and presentation logic in small PONSO's to achieve better separation of concerns and think view controller. To wire up dependencies, particularly those PONSO instances with view elements and actions I heavily used Interface Builder. In this post I will show how you can do the same using IoC-container instead of Interface Builder. As example of such IoC container implementation I will use <a href=\"http://www.typhoonframework.org\">Typhoon</a> framework. To checkout the full code you can use <a href=\"https://github.com/ilyapuchka/ViewControllerThinning/tree/typhoon\">this repo</a>.</p>\n<p>First lets start with defining what <em>IoC-container</em> (\"Inversion-Of-Control-Container\") is. I will not dive deep in theory of Inversion Of Control principle, you better read about that <a href=\"http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod\">somewhere else</a>. IoC-container serves to simplify and automate the process of defining and resolving dependencies between software system components. Basically what IoC-container does is that it provides some API to register components and to resolve them later. Sometimes it can even resolve them for you so you don't even need to call any method to create an instance of your component. Imagine that you have component that depends on lot's of other components:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> apiClient <span class=\"token operator\">=</span> <span class=\"token class-name\">ApiClient</span><span class=\"token punctuation\">(</span>hostProvider<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ApiHostProvider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> requestFactory<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ApiRequestFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> requestSerializer<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ApiRequestSerializer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> responseSerializer<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ApiResponseSerializer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cookiesStorage<span class=\"token punctuation\">:</span> <span class=\"token class-name\">CookiesStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> logger<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ApiLogger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>With IoC-container you can use something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> apiClient<span class=\"token punctuation\">:</span> <span class=\"token class-name\">ApiClient</span> <span class=\"token operator\">=</span> networkComponents<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>You can easily use <em>Dependency Injection</em> pattern without any containers in relatively small systems but when number of components in your system grows so the number of dependencies grows and at some point you will end up with a lot of code that just wires things together. This setup logic can be scattered over you code. Instead you should aim to concentrate setup in one point. Basically it would be the earliest entry point of you program. Speaking of iOS app you can think of your app delegate. This is not perfect solution though. In large system you will have app delegate bloated with setup of different components. Also sometimes it's not possible or not efficient to define all dependencies at startup. You may need to decide what components to use at runtime depending on the state of your system or user input. This is when IoC-container will be very handy.</p>\n<p>So let's look at Typhoon, so far the best IoC-container for Cocoa.</p>\n<h4>Typhoon</h4>\n<p>The way you use it is that you define <em>assemblies</em> that provide <em>definitions</em> for your system components. Definitions define the type of component they describe and how it will be created at runtime - what initializer will be used, what properties will be injected during resolution process and what methods will be called. You can think of assemblies as classes that provide factory methods for your components. But instead of manually creating components that factory methods return definitions for this components that Typhoon use later to create real components. What makes Typhoon even better is that you can seamlessly integrate it step by step in your application. You don't have to make you system Typhoon-centric and strongly depend on it. Also it works great with storyboards so it's very easy to start inject things. In runtime Typhoon will detect types of view controllers and inject their dependencies if you provide appropriate definitions.</p>\n<p>Let's go back to our project and see how Typhoon can be used in practice. My view controller with login form have few dependencies, currently injected with Interface Builder. So I need to provide definition to instruct Typhoon what it should inject in this controller. To do that I define subclass of <code>TyphoonAssembly</code> and provide definition for <code>ViewController</code> class:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">UIComponents</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">TyphoonAssembly</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">dynamic</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">authViewController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">AnyObject</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">TyphoonDefinition</span><span class=\"token punctuation\">.</span><span class=\"token function\">withClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> def <span class=\"token keyword\">in</span>\n            def<span class=\"token punctuation\">.</span><span class=\"token function\">injectProperty</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"nibName\"</span></span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"AuthView\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here I create method that returns <code>TyphoonDefinition</code> for <code>ViewController</code> class. From now on every time Typhoon stumble on <code>ViewController</code> in storyboard it will use this definition to setup this controller. Here setup is very simple, I just say that Typhoon should inject property <code>nibName</code> and set its value to <code>AuthView</code>. This way view controller will be loaded with root view from xib with this name. No I don't need to override this property in view controller.</p>\n<p>Next I will add definition for form behavior:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">dynamic</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">authViewController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">AnyObject</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">TyphoonDefinition</span><span class=\"token punctuation\">.</span><span class=\"token function\">withClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> def <span class=\"token keyword\">in</span>\n        <span class=\"token operator\">...</span>\n        def<span class=\"token punctuation\">.</span><span class=\"token function\">injectProperty</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"formBehaviour\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">dynamic</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">authFormBehaviour</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">AnyObject</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">TyphoonDefinition</span><span class=\"token punctuation\">.</span><span class=\"token function\">withClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AuthFormBehaviour</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>def <span class=\"token keyword\">in</span>\n        def<span class=\"token punctuation\">.</span><span class=\"token function\">useInitializer</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"initWithAPIClient:\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> method <span class=\"token keyword\">in</span>\n            <span class=\"token operator\">...</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here I say that to create form behavior instance I want Typhoon to use its <code>initWithAPIClient:</code> initializer. I will get back to that definition in a minute to explain details.</p>\n<p>Next I can define animations:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">dynamic</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">shakeAnimaton</span><span class=\"token punctuation\">(</span>view<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">AnyObject</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">TyphoonDefinition</span><span class=\"token punctuation\">.</span><span class=\"token function\">withClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ShakeAnimationImp</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> def <span class=\"token keyword\">in</span>\n        def<span class=\"token punctuation\">.</span><span class=\"token function\">injectProperty</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"view\"</span></span><span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> view<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here I use another feature of Typhoon - runtime arguments. When animation object will be created its <code>view</code> property will be set to the view passed to this definition as argument.</p>\n<p>But wait, view controller does not have references to animation objects, instead input fields, subviews of its root view store them. So how I can set them? I don't have access to view controller or its view in definition, there is simply no object created yet when we define definition. The way it can be solved is that Typhoon can call arbitrary methods (injection callbacks) on created object before returning it. The drawback of this method is that I will have to access view property in this method what will load view earlier. Usually it's not a problem cause in most cases view is loaded shortly after view controller is created. But if it does not work well than you can inject assembly itself to view controller and access its definition to resolve animations in <code>viewDidLoad</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">dynamic</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">authViewController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">AnyObject</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">TyphoonDefinition</span><span class=\"token punctuation\">.</span><span class=\"token function\">withClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> def <span class=\"token keyword\">in</span>\n        <span class=\"token operator\">...</span>\n        def<span class=\"token punctuation\">.</span><span class=\"token function\">performAfterInjections</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"typhoonDidInject:\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> method <span class=\"token keyword\">in</span>\n            method<span class=\"token punctuation\">.</span><span class=\"token function\">injectParameterWith</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token class-name\">ViewController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">typhoonDidInject</span><span class=\"token punctuation\">(</span>uiComponents<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIComponents</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        authView<span class=\"token punctuation\">.</span>userNameInput<span class=\"token punctuation\">.</span>shakeAnimation <span class=\"token operator\">=</span> uiComponents<span class=\"token punctuation\">.</span><span class=\"token function\">shakeAnimaton</span><span class=\"token punctuation\">(</span>authView<span class=\"token punctuation\">.</span>userNameInput<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token class-name\">ShakeAnimationImp</span>\n        authView<span class=\"token punctuation\">.</span>passwordInput<span class=\"token punctuation\">.</span>shakeAnimation <span class=\"token operator\">=</span> uiComponents<span class=\"token punctuation\">.</span><span class=\"token function\">shakeAnimaton</span><span class=\"token punctuation\">(</span>authView<span class=\"token punctuation\">.</span>passwordInput<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token class-name\">ShakeAnimationImp</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here I define that as a last step of resolve process Typhoon should call <code>typhoonDidInject:</code> method of view controller with assembly as it's argument. Using this assembly I can access <code>shakeAnimtion</code> definition and resolve it.</p>\n<p>In the same method I can finish wiring by connecting form behavior input fields to auth view subviews and adding actions to buttons:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function-definition function\">typhoonDidInject</span><span class=\"token punctuation\">(</span>uiComponents<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIComponents</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    formBehaviour<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>userNameInput <span class=\"token operator\">=</span> authView<span class=\"token punctuation\">.</span>userNameInput\n    formBehaviour<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>passwordInput <span class=\"token operator\">=</span> authView<span class=\"token punctuation\">.</span>passwordInput\n    authView<span class=\"token punctuation\">.</span>loginButton<span class=\"token punctuation\">.</span><span class=\"token function\">addTarget</span><span class=\"token punctuation\">(</span>formBehaviour<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"submitForm\"</span></span><span class=\"token punctuation\">,</span> forControlEvents<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">TouchUpInside</span><span class=\"token punctuation\">)</span>\n    authView<span class=\"token punctuation\">.</span>cancelButton<span class=\"token punctuation\">.</span><span class=\"token function\">addTarget</span><span class=\"token punctuation\">(</span>formBehaviour<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"cancelForm\"</span></span><span class=\"token punctuation\">,</span> forControlEvents<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span><span class=\"token class-name\">TouchUpInside</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now it's time to go back to definition of network components.<br>\nFirst of all I want to separate UI components assembly from network components assembly. But then to inject api client to form behavior I will need to somehow reference to network components assembly in UI components assembly so that I can do something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">def<span class=\"token punctuation\">.</span><span class=\"token function\">useInitializer</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"initWithAPIClient:\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> method <span class=\"token keyword\">in</span>\n    method<span class=\"token punctuation\">.</span><span class=\"token function\">injectParameterWith</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>networkComponents<span class=\"token punctuation\">.</span><span class=\"token function\">apiClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>For that there is a mechanism in Typhoon called collaborating assemblies. To use it I can define a property of another assembly on UI components assembly.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">private</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">set</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">var</span> networkComponents<span class=\"token punctuation\">:</span> <span class=\"token class-name\">NetworkComponents</span><span class=\"token operator\">!</span></code></pre></div>\n<p>When Typhoon will initialize UI components assembly it will inspect its properties and search for those that are subclasses of <code>TyphoonAssembly</code>. When it finds one it will search for assembly that it can inject in this property. So now I need to define assembly for network components:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">NetworkComponents</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">TyphoonAssembly</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token keyword\">dynamic</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">apiClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">AnyObject</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">TyphoonDefinition</span><span class=\"token punctuation\">.</span><span class=\"token function\">withClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">APIClientBox</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>def<span class=\"token punctuation\">:</span> <span class=\"token class-name\">TyphoonDefinition</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n            def<span class=\"token punctuation\">.</span><span class=\"token function\">useInitializer</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"init:\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>initializer<span class=\"token punctuation\">:</span> <span class=\"token class-name\">TyphoonMethod</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n                initializer<span class=\"token punctuation\">.</span><span class=\"token function\">injectParameterWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">NetworkComponents</span><span class=\"token punctuation\">.</span>apiClientInstance<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">let</span> apiClientInstance<span class=\"token punctuation\">:</span> <span class=\"token class-name\">APIClient</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> host <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"http://localhost:2368\"</span></span>\n        <span class=\"token keyword\">let</span> client <span class=\"token operator\">=</span> <span class=\"token class-name\">APIClient</span><span class=\"token punctuation\">(</span>baseURL<span class=\"token punctuation\">:</span> <span class=\"token function\">NSURL</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">:</span> host<span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> client\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now my two assemblies will be connected and UI components assembly will be able to use definitions from network components assembly in it's own definitions.</p>\n<p>The other interesting thing here is that Typhoon can not inject Swift-native classes. So I wrap <code>APIClient</code> in simple PONSO wrapper and inject it instead.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">APIClientBox</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSObject</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> unboxed<span class=\"token punctuation\">:</span> <span class=\"token class-name\">APIClient</span>\n    <span class=\"token keyword\">dynamic</span> <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span><span class=\"token omit keyword\">_</span> boxed<span class=\"token punctuation\">:</span> <span class=\"token class-name\">AnyObject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        unboxed <span class=\"token operator\">=</span> boxed <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token class-name\">APIClient</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The last thing left to do is to tell Typhoon what assemblies it should activate at startup. There are different ways to provide initial assemblies - manual, using plist and using app delegate.<br>\nTo do it with app delegate I just need to implement <code>initialAssemblies()</code> method and return classes of assemblies that should be activated. Then Typhoon will activate them at the earliest point. After activation assembly will no longer return definitions from its methods, instead it will return resolved instances.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">AppDelegate</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">initialAssemblies</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">AnyClass</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">NetworkComponents</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">UIComponents</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Conclusion</h4>\n<p>Typhoon is very powerful framework for DI. You can build very complex systems with complex graphs of dependencies and they all will be described using uniform and easy to read API. But Typhoon was originally designed for Objective-C and uses it's runtime features heavily. Thanks to languages interoperability it still works in Swift with some <a href=\"https://github.com/appsquickly/Typhoon/wiki/Swift-Quick-Start\">restrictions and requirements</a>. In some cases I think it's even better to use Objective-C to define assemblies. For native Swift code it's rather easy to create basic IoC but supporting all of the features available in Objective-C looks impossible.<br>\nComparing with Interface Builder Typhoon requires more code of course, but it provides well defined point of setup, separated from the rest of the system, it provides uniform API to describe dependencies and it's just easier to follow code than expecting connections in Interface Builder. But no matter what approach you prefer I hope by this moment you share the with me understanding of actually very simple fact that proper dependency management, SRP and other principles are very important.</p>","fields":{"slug":"/view-controller-thinning-dependency-injection/"},"frontmatter":{"id":"5b6f5a3a9d28c70f0f015f6a","title":"View controller thinning. Dependency injection with Typhoon.","date":"October 27, 2015","description":"In my previous post I described how you can break business and presentation logic in small PONSO's to achieve better separation of concerns and think view controller. To wire up dependencies, particularly those PONSO instances with view elements and actions I heavily used Interface Builder. In this post I will show how you can do the same using IoC-container instead of Interface Builder. As example of such IoC container implementation I will use Typhoon framework. To checkout the full code you can use this repo.","tags":""}},"previous":{"excerpt":"In previous post I showed how you can move some presentation logic from view controller to view. Now view controller is responsible only for business logic, in…","fields":{"slug":"/view-controller-thinning-behaviours-and-interface-builder/"},"frontmatter":{"title":"View controller thinning. Behaviors and Interface Builder.","date":"October 10, 2015"}},"next":{"excerpt":"Note (15.04.16): This post is updated to reflect some of the latest changes in Dip. In my previous post I talked about dependency injection framework for…","fields":{"slug":"/ioc-container-in-swift/"},"frontmatter":{"title":"IoC container in Swift","date":"November 08, 2015"}}},"pageContext":{"id":"3000126a-7b9c-5297-a86f-115d5d881ed7","previousPostId":"d76806a0-7d65-56cd-aab9-d6823bb19d58","nextPostId":"0c3802aa-a58a-59fa-aea8-be9c2456921c"}},"staticQueryHashes":["2355076697","2841359383"],"slicesMap":{}}